.NET GC的大总管Maoni发了一篇新文章《[准备 .NET 10 GC](https://github.com)》,准备 .NET 10 GC” 并非单一动作，而是 “**代码优化（减少 GC 压力）+ 配置预留（适配新特性）+ 环境兼容（保障运行基础）** ” 的组合：核心是基于 .NET GC 的演进规律，提前消除 “性能瓶颈” 和 “兼容性风险”，确保 .NET 10 发布后，应用能直接享受到新版本 GC 的低延迟、高内存效率优势。 以下是.NET 10中GC（垃圾收集器）特性的总结:

###### 1. **DATAS（Dynamic Adaptation To Application Sizes）**

* **默认启用**：在.NET 9中，DATAS功能已被引入但未默认启用；而在.NET 10中，DATAS将成为默认特性。这对于从旧版本升级到.NET 10的用户来说是一个显著的变化。
* **设计目标**：DATAS旨在根据应用程序的实际大小动态调整堆大小，特别适用于内存受限环境下的突发性工作负载和小型工作负载使用Server GC的场景。
* **性能影响**：
  + **内存使用**：与传统的Server GC相比，DATAS可能会显著减少内存使用，尤其是在非高峰时段。
  + **吞吐量**：对于某些场景，特别是那些对吞吐量有极高要求且不能容忍任何性能下降的场景，DATAS可能不是最佳选择，因为它可能会在某些情况下降低吞吐量。

###### 2. **性能特征与权衡**

* **堆大小变化**：使用DATAS时，堆大小可能会根据应用程序的需求动态变化，这在不同核心数的机器上表现更为一致。
* **GC暂停时间**：DATAS通过调整第0代（gen0）的分配预算来控制GC频率和暂停时间，目标是通过维持一个合理的吞吐量成本百分比（TCP, Throughput Cost Percentage）来优化性能。
* **适应场景**：
  + **突发性工作负载**：在内存受限的环境中，DATAS能在工作负载减轻时收缩堆大小，在工作负载增加时扩展堆大小。
  + **小型工作负载**：对于使用Server GC的小型应用，DATAS能提供更符合实际需求的堆大小。

###### 3. **配置与调优**

* **关键配置项**：
  + `GCDynamicAdaptationMode`：用于启用或禁用DATAS。
  + `GCDTargetTCP`：设置目标吞吐量成本百分比，影响GC频率和堆大小调整。
  + `GCDGen0GrowthPercent` 和 `GCDGen0GrowthMinFactor`：用于调整第0代分配预算的增长比例和最小增长因子。
* **调优建议**：
  + 对于对启动性能敏感的应用，可能需要禁用DATAS，因为它从单个堆开始，需要时间扩展到多个堆。
  + 对于不能容忍任何吞吐量下降的场景，应评估DATAS的影响，并考虑禁用或调整其参数。
  + 对于主要进行第2代（gen2）GC的场景，DATAS可能效果不佳，建议评估后决定是否禁用。

###### 4. **监控与分析**

* **事件与指标**：DATAS提供了特定的事件和指标，如LDS（Live Data Size）和TCP，用于详细分析和调优。这些事件主要通过编程方式访问，例如使用TraceEvent库。
* **分析工具**：虽然PerfView等工具不直接显示DATAS的详细事件，但可以通过编程方式检索和分析这些数据。

###### 5. **适用场景与禁用条件**

* **适用场景**：
  + 内存受限环境下的突发性工作负载。
  + 使用Server GC的小型应用。
  + 希望通过动态调整堆大小来优化内存使用的场景。
* **禁用条件**：
  + 对启动性能有极高要求的场景。
  + 不能容忍任何吞吐量下降的场景。
  + 主要进行第2代GC且对DATAS效果不满意的场景。
  + 没有使用释放内存需求的场景（如运行在专用机器上的进程）。

.NET 10中的GC特性以DATAS为核心，通过动态调整堆大小来优化内存使用和性能。虽然DATAS在许多场景下能带来显著的优势，但也存在一些不适用的场景。用户应根据自己的应用需求和性能目标来评估是否启用DATAS，并通过适当的配置和调优来最大化其效益。

本博客参考[橘子云加速器](https://za79.com)。转载请注明出处！
